#!/usr/bin/env bash

sink=$(pacmd list-sinks | grep '*' | awk '{print $3}')

volume_up() {
    pactl set-sink-volume $sink +5%
}

volume_down() {
    pactl set-sink-volume $sink -5%
}

volume_mute() {
    pactl set-sink-mute $sink toggle
}

mic_mute() {
    pactl set-source-mute 1 toggle
}

set_volume() {
    pactl set-sink-mute $sink false
    pactl set-sink-volume $sink $1%
}

volume_print() {
    muted=$(pamixer --sink $sink --get-mute)

    if [ "$muted" = true ]; then
        echo " MUTE"
    else
        volume=$(pamixer --sink $sink --get-volume)

        if [ "$volume" -lt 50 ]; then
            echo " $volume%"
        else
            echo " $volume%"
        fi
    fi
}

listen() {
    volume_print

    pactl subscribe | while read -r event; do
        if echo "$event" | grep -q "#$sink"; then
            sink=$(pacmd list-sinks | grep '*' | awk '{print $3}')
            volume_print
        fi
    done
}

case "$1" in
    --up)
        volume_up
        ;;
    --down)
        volume_down
        ;;
    --mute)
        volume_mute
        ;;
    --mic-mute)
        mic_mute
        ;;
    --set-volume)
        set_volume $2
        ;;
    *)
        listen
        ;;
esac
